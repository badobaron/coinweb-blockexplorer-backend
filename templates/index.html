{% extends 'template.html' %}

{% block title %}
<title>Coinweb Block Explorer</title>
{% endblock %}

{% block main %}
<div class="row">
    <div class="col l4 offset-l1 m10 offset-m1">
        <ul class="collection with-header">
            <li class="collection-header black white-text">
                Counterparty Stats
                <span class="badge white-text" id="transactions_number"></span>
            </li>
            <li class="collection-item">
                <table class="striped">
                    <tbody>
                    <tr>
                        <th class="grey lighten-1">Assets</th>
                        <td id="assets"></td>
                        <th class="grey lighten-1">Dividends</th>
                        <td id="dividends"></td>
                    </tr>
                    <tr>
                        <th>Bets</th>
                        <td id="bets"></td>
                        <th>Issuances</th>
                        <td id="issuances"></td>
                    </tr>
                    <tr>
                        <th class="grey lighten-1">Broadcasts</th>
                        <td id="broadcasts"></td>
                        <th class="grey lighten-1">Orders</th>
                        <td id="orders"></td>
                    </tr>
                    <tr>
                        <th>Burns</th>
                        <td id="burns"></td>
                        <th>Sends</th>
                        <td id="sends"></td>
                    </tr>
                    </tbody>
                </table>
            </li>
        </ul>
    </div>


    <div class="col l3 m5 offset-m1">
        <ul class="collection with-header">
            <li class="collection-header black white-text">Currency Information</li>
            <li class="collection-item">
                <table class="striped">
                    <tbody>
                    <tr>
                        <th class="grey lighten-1">MarketCap</th>
                        <td id="marketcap"></td>
                    </tr>
                    <tr>
                        <th>24h Volume</th>
                        <td id="24volume"></td>
                    </tr>
                    <tr>
                        <th class="grey lighten-1">USD Price</th>
                        <td id="usd"></td>
                    </tr>
                    <tr>
                        <th>BTC Price</th>
                        <td id="btc"></td>
                    </tr>
                    </tbody>
                </table>
            </li>
        </ul>
    </div>


    <div class="col l3 m5">
        <ul class="collection with-header">
            <li class="collection-header black white-text">Counterparty Stats</li>
            <li class="collection-item">
                <table class="striped">
                    <tbody>
                    <tr>
                        <th class="grey lighten-1">Block#</th>
                        <td id="block"></td>
                    </tr>
                    <tr>
                        <th>Unconfirmed</th>
                        <td id="unconfirmed"></td>
                    </tr>
                    <tr>
                        <th class="grey lighten-1">Low fee</th>
                        <td id="low_fee"></td>
                    </tr>
                    <tr>
                        <th>Optimal fee</th>
                        <td id="optimal_fee"></td>
                    </tr>
                    </tbody>
                </table>
            </li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="col s12">
        <ul class="tabs  black tabs-transparent">
            <li class="tab col s3 m3 l3 xl3"><a class="active" href="#assets_table">Assets</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#bets_table">Bets</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#blocks_table">Blocks</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#broadcasts_table">Broadcasts</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#burns_table">Burns</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#dividends_table">Dividends</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#issuances_table">Issuances</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#markets_table">Markets</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#orders_table">Orders</a></li>
            <li class="tab col s3 m3 l3 xl3"><a href="#sends_table">Sends</a></li>
        </ul>
    </div>


    <!--Assets table-->
    <div id="assets_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                All Assets
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="assets_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Asset</th>
                                    <th>Asset Description</th>
                                    <th>Total Supply</th>
                                    <th>Divisible</th>
                                    <th>Locked</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Bets table-->
    <div id="bets_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Bets
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="bets_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>Feed</th>
                                    <th>Fee</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Blocks table-->
    <div id="blocks_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">link</i>
                                Blocks
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="blocks_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Hash</th>
                                    <th>Time</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Broadcasts-->
    <div id="broadcasts_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Broadcasts
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="broadcasts_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>Message</th>
                                    <th>Value</th>
                                    <th>Fee</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Burns-->
    <div id="burns_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Burns
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="burns_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>BTC Burned</th>
                                    <th>XCP Earned</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Dividends-->
    <div id="dividends_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Dividends
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="dividends_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>Asset</th>
                                    <th>Dividend Asset</th>
                                    <th>Quantity Per Unit</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Issuances-->
    <div id="issuances_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Issuances
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="issuances_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Asset</th>
                                    <th>Quantity</th>
                                    <th>Locked</th>
                                    <th>Transfer</th>
                                    <th>Fee</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--TODO add markets-->
    <!--Markets-->
    <div id="markets_table" class="col s10 offset-s1"><p>Markets</p></div>


    <!--Orders-->
    <div id="orders_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Orders
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="orders_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Market</th>
                                    <th>Buying</th>
                                    <th>Selling</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!--Sends-->
    <div id="sends_table" class="col s10 offset-s1">
        <div class="container">
            <div class="row center">
                <div class="col s12">
                    <ul class="collection with-header">
                        <li class="collection-header">
                            <h5>
                                <i class="material-icons left">storage</i>
                                Sends
                                <span class="badge">72,000 results</span>
                            </h5>
                        </li>
                        <li class="collection-item">
                            <table class="highlight" id="sends_table_info">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Block</th>
                                    <th>Time</th>
                                    <th>Asset</th>
                                    <th>Quantity</th>
                                    <th>Destination</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </li>
                        <li class="collection-item">
                            <ul class="pagination center-align">
                                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                                <li class="active"><a href="#!">1</a></li>
                                <li class="waves-effect"><a href="#!">2</a></li>
                                <li class="waves-effect"><a href="#!">3</a></li>
                                <li class="waves-effect"><a href="#!">4</a></li>
                                <li class="waves-effect"><a href="#!">5</a></li>
                                <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts%}
<!--Make tabs using materialize-->
<script>
    $(document).ready(function () {
        $('.tabs').tabs();
    });
</script>

<script>
    //add .format function
    String.prototype.format = function () {
        var args = [].slice.call(arguments);
        return this.replace(/(\{\d+\})/g, function (a) {
            return args[+(a.substr(1, a.length - 2)) || 0];
        });
    };


    var per_page = 10;
    //request to the server
    $.ajax({
        url: '/indexInfo',
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        data: JSON.stringify({'per_page': 10}, null, '\t'),
        success: function (response) {
            response = JSON.parse(response);
            console.log(response['blocks']);

            //Fill 'counterparty stats' table with data
            //TODO: how to get assets quantity
            $('#transactions_number').text(response['transactions'].toLocaleString('en') + ' Transactions');
            // $('#assets').text(response['bets'].toLocaleString('en'));
            $('#bets').text(response['bets'].toLocaleString('en'));
            $('#broadcasts').text(response['broadcasts'].toLocaleString('en'));
            $('#burns').text(response['burns'].toLocaleString('en'));
            $('#dividends').text(response['dividends'].toLocaleString('en'));
            $('#issuances').text(response['issuances'].toLocaleString('en'));
            $('#orders').text(response['orders'].toLocaleString('en'));
            $('#sends').text(response['sends'].toLocaleString('en'));


            //Fill 'currency information' table with data


            //Fill 'counterparty stats' table with data
            $('#block').text(response['block_index'].toLocaleString('en'));


            // var default_string = "<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>";
            // var my_table = $("#bets").find('tbody')
            // response.slice(0, per_page).forEach(function (bet, i, response) {
            //     my_table.append($('<tr>')
            //         .append(default_string.format(i + 1, bet['block_index'], '?', bet['source'], bet['feed_address'], (bet['fee_fraction_int'] / 1000000).toFixed(2) + '%'))
            //     );
            // })
        }
    })
</script>
{% endblock %}