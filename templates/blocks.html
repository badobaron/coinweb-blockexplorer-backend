{% extends 'template.html' %}

{% block title %}
<title>Blocks :: Coinweb Block Explorer</title>
{% endblock %}

{% block main %}
<div class="container">
    <div class="row center">
        <div class="col s12">
            <h1 class="header">Blocks</h1>
        </div>
        <!--Blocks-->
        <div class="col s12">
            <ul class="collection with-header">
                <li class="collection-header">
                    <h5>
                        <i class="material-icons left">link</i>
                        Blocks
                        <span class="badge">72,000 results</span>
                    </h5>
                </li>
                <li class="collection-item">
                    <table class="highlight" id="blocks">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Block</th>
                            <th>Hash</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </li>
                <li class="collection-item">
                    <ul class="pagination center-align">
                        <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                        <li class="active"><a href="#!">1</a></li>
                        <li class="waves-effect"><a href="#!">2</a></li>
                        <li class="waves-effect"><a href="#!">3</a></li>
                        <li class="waves-effect"><a href="#!">4</a></li>
                        <li class="waves-effect"><a href="#!">5</a></li>
                        <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

<script>
    //add .format function
    String.prototype.format = function () {
        var args = [].slice.call(arguments);
        return this.replace(/(\{\d+\})/g, function (a) {
            return args[+(a.substr(1, a.length - 2)) || 0];
        });
    };


    var per_page = 10;
    //request to the server
    $.ajax({
        url: '/blocksAll',
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        data: JSON.stringify({'per_page': per_page}, null, '\t'),
        success: function (response) {
            response = JSON.parse(response);
            var default_string = "<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td>";
            var my_table = $("#blocks").find('tbody');
            response.slice(0, per_page).forEach(function (bet, i, response) {
                my_table.append($('<tr>')
                    .append(default_string.format(i + 1, bet['block_index'], bet['block_hash'], bet['time'])))
            })
        }
    })

</script>

<script>
    $.ajax({
        url: '/sendsAll',
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        data: JSON.stringify({'per_page': per_page}, null, '\t'),
        success: function (response) {
            response = JSON.parse(response);
            var default_string = "<td>{0}</td><td>{1}</td><td>{2}</td><td>{3}</td><td>{4}</td><td>{5}</td>";
            var my_table = $("#sends_table_info").find('tbody');
            response.slice(0, per_page).forEach(function (send, i, response) {
                my_table.append($('<tr>')
                    /*
                    {0} #
                    {1} block_index
                    {2} time
                    {3} asset
                    {4} (quantity/100000000 if quantity.length >=7 else quantity)
                    {5} destination
                    I add if statements in {4}, because quantities are given in different
                    dimensions, so some low cost currencies may be represented incorrectly.
                    Example: give_quantity: 1000000000 BitCrystals
                    will be represented like 1000000000 but must be like 10 BitCrystals.

                    There may be bugs with this idea so there must be more smarter way how to deal with this.
                    */
                        .append(default_string.format(i + 1, send['block_index'], '?', send['asset'], (send['quantity'].toString().length>=7?(send['quantity'] / 100000000).toFixed(9):send['quantity']), send['destination']))
                );
            })
        }
    })
</script>

{% endblock %}